<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ session.username }}'s Cart - Lego Marketplace</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/output.css">
</head>
<body>
    <div class="navbar bg-warning text-base-content shadow-md">
        <div class="navbar-start">
            <a href="{{ url_for('index') }}" class="btn btn-ghost text-xl font-bold">Lego Marketplace</a>
        </div>
        <div class="navbar-center"></div>
        <div class="navbar-end">
            <a href="{{ url_for('index') }}" class="btn btn-ghost mr-2">Browse Market</a>
            {% if session.username %}
                <span class="mr-4 text-sm font-semibold">Hello, {{ session.username }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-error">Logout</a>
            {% endif %}
        </div>
    </div>

    <main class="container mx-auto px-4 mt-8">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} shadow-lg mb-4"><span>{{ message }}</span></div>
            {% endfor %}
          {% endif %}
        {% endwith %} 

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2">
                <h1 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    üõí Shopping Cart
                </h1>
                
                <div class="overflow-x-auto bg-base-100 rounded-lg shadow-sm border">
                    <table class="table w-full">
                        <thead class="bg-base-200">
                            <tr>
                                <th>Item</th>
                                <th>Seller</th>
                                <th>Price</th>
                                <th>Qty</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in cart_items %}
                            <tr>
                                <td>
                                    <div class="font-bold">{{ item.inventory.piece.name }}</div>
                                    <div class="text-sm opacity-50">{{ item.inventory.color.name }} - {{ item.inventory.condition }}</div>
                                </td>
                                <td>{{ item.inventory.user.username }}</td>
                                <td>${{ item.inventory.set_price }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>
                                    <a href="{{ url_for('remove_cart', id=item.id) }}" class="btn btn-sm btn-error btn-outline">Remove</a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center py-8 text-gray-500">Your cart is empty.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if cart_items %}
                <div class="flex justify-end mt-4">
                    <div class="card w-72 bg-base-100 shadow-xl border">
                        <div class="card-body p-4">
                            <h2 class="card-title justify-between">
                                Total: 
                                <span class="text-primary">${{ total_price }}</span>
                            </h2>
                            <div class="card-actions justify-end mt-2">
                                <button class="btn btn-success w-full text-white">Checkout</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <div>
                <h1 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    ‚ù§Ô∏è Wishlist
                </h1>
                
                <div class="grid grid-cols-1 gap-4">
                    {% for item in wishlist_items %}
                    <div class="card bg-base-100 shadow-sm border p-4 flex flex-row justify-between items-center">
                        <div>
                            <h3 class="font-bold text-sm">{{ item.inventory.piece.name }}</h3>
                            <p class="text-xs text-gray-500">{{ item.inventory.color.name }}</p>
                            <p class="text-sm font-semibold text-success">${{ item.inventory.set_price }}</p>
                        </div>
                        <div class="flex flex-col gap-2">
                            <a href="{{ url_for('move_to_cart', wishlist_id=item.id) }}" class="btn btn-xs btn-primary">Add to Cart</a>
                            <a href="{{ url_for('remove_wishlist', id=item.id) }}" class="btn btn-xs btn-ghost text-error">Remove</a>
                        </div>
                    </div>
                    {% else %}
                    <div class="alert bg-base-100 border text-sm text-gray-500">
                        Your wishlist is empty.
                    </div>
                    {% endfor %}
                </div>
            </div>

        </div>
    </main>
</body>
</html>